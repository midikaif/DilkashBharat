<% layout('layouts/boilerplate')%>
<div class="glass index-container max-w-7xl mx-auto">

<div id="map" style="width: 100%; height: 500px; border-radius: 20px; opacity: .95;"></div>

  <!-- Title -->
  <h1
    class="places-title text-6xl text-center py-6 font-extrabold text-white drop-shadow-lg"
  >
    All Places
  </h1>

  <!-- Add New Place Button -->
  <div class="text-right mb-8">
    <a
      class="inline-flex items-center justify-center text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-xl text-base px-6 py-3 shadow-lg transition duration-200 transform hover:scale-[1.02] focus:outline-none"
      href="/places/new"
    >
      + Add New Place
    </a>
  </div>
  <div class="places-container space-y-6 p-6 md:p-12 max-w-5xl mx-auto overflow-x-hidden">
    <% for(let place of allPlaces){ %>
    <a
      href="/places/<%= place._id %>"
      class="dynamic-card flex flex-col md:flex-row rounded-xl shadow-lg overflow-hidden transition duration-300 backdrop-blur-md bg-white/20 border border-solid border-white/30 hover:shadow-2xl group"
    >
      <div class="card-img-box">
        <img
          class="object-cover w-full h-full rounded-t-xl md:rounded-l-xl md:rounded-tr-none"
          src="<%= place?.images[0]?.url %>"
          alt="Image of <%= place.title %>"
          onerror="this.onerror=null; this.src='https://placehold.co/600x400/6EE7B7/000000?text=<%= place.title %>'"
        />
      </div>

      <div class="card-content flex flex-col justify-center p-6 w-full lg:w-2/3 relative z-0"
      >
        <h2
          class="mb-2 text-3xl font-bold tracking-tight text-white drop-shadow-lg"
        >
          <%= place.title %>
        </h2>

          <div class="card-content-text mt-4 transition-opacity duration-500">
          <p
            class="card-description mb-3 text-lg font-normal text-gray-100"
          >
            <%= place.description %>
          </p>
          
        </div>
      </div>
    </a>
    <% } %>
  </div>
</div>


<%- "<script>" %>
const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
const places = {
  type: "FeatureCollection",
  features: <%- JSON.stringify(
    allPlaces.map(place => ({
      type: "Feature",
      geometry: place.geometry,
      properties: { popUpMarkup: place?.properties?.popUpMarkup }
    }))
  ) %>
};
<%- "</script>" %>

<script src="/js/clusterMap.js"></script>